{% extends 'base.html' %}
{% block title %}Login · App Motorista{% endblock %}
{% block page_class %}auth{% endblock %}
{% block content %}
<div class="logo-wrap">
  <img src="{{ url_for('static', filename='Logo-Delante-Branco-scaled.webp') }}" alt="Delante" class="brand-logo">
</div>

<section class="hero auth-hero">
  <p class="eyebrow">Acesso</p>
  <h1>Entrar no app</h1>
  <p class="lede">Use seu Google account ou usuário e senha.</p>
</section>

<section class="card narrow">
  <!-- Google Sign-In Button -->
  <div id="google_signin_container">
    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="dark" data-text="signin_with" data-shape="rectangular" data-logo_alignment="left" data-width="100%"></div>
  </div>

  <div class="form-divider">ou</div>

  <form method="post" class="form">
    <div class="field">
      <label for="username">Usuário</label>
      <input id="username" name="username" type="text" autocomplete="username" required>
    </div>
    <div class="field">
      <label for="password">Senha</label>
      <input id="password" name="password" type="password" autocomplete="current-password" required>
    </div>
    <div class="actions">
      <button type="submit" class="primary">Entrar</button>
    </div>
  </form>
  <a href="{{ url_for('signup') }}" class="secondary full-width" style="text-align: center; display: block; margin-top: 12px;">Criar Nova Conta</a>
</section>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
  window.onload = function() {
    const clientId = "{{ GOOGLE_CLIENT_ID }}";
    
    // Only initialize if client ID is set
    if (clientId && clientId !== "") {
      try {
        google.accounts.id.initialize({
          client_id: clientId,
          callback: handleCredentialResponse
        });
        google.accounts.id.renderButton(
          document.getElementById('google_signin_container'),
          { 
            type: 'standard', 
            size: 'large', 
            theme: 'dark',
            text: 'signin_with',
            shape: 'rectangular',
            logo_alignment: 'left',
            width: '100%'
          }
        );
      } catch (e) {
        console.error("Error initializing Google Sign-In:", e);
      }
    } else {
      console.warn("GOOGLE_CLIENT_ID not configured");
      // Hide the Google Sign-In container if not configured
      document.getElementById('google_signin_container').style.display = 'none';
    }
  };

  function handleCredentialResponse(response) {
    // The response contains JWT in response.credential
    console.log("Google Sign-In response received");
    
    // Send the token to the backend
    fetch("{{ url_for('google_callback') }}", {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        credential: response.credential
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        console.error("Error:", data.error);
        alert("Erro ao fazer login: " + data.error);
      } else if (data.redirect) {
        window.location.href = data.redirect;
      }
    })
    .catch(error => {
      console.error("Fetch error:", error);
      alert("Erro ao conectar com Google");
    });
  }
</script>

<style>
  #google_signin_container {
    display: flex;
    justify-content: center;
    margin-bottom: 16px;
  }
  
  #google_signin_container > div {
    width: 100%;
  }
</style>
{% endblock %}
